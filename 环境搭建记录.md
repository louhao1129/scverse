# 心得

Linux中使用pip安装squidpy速度慢且容易出错（这可能是Python版本的问题，建议使用conda安装scanpy和squidpy，可以自动调整Python版本）

source /data/share/nas1/clks/config/proxy/clash-pub.proxyrc

安装软件的时候不建议指定Python版本，直接在创建环境的时候安装对应的包即可
conda create -n info squidpy

## 给conda添加频道
channels:
  - conda-forge
  - bioconda
  - defaults

清除所有已配置的频道
conda config --remove-key channels

清除频道优先级设置（如果有）
conda config --remove-key channel_priority

添加频道
conda config --add channels defaults
conda config --add channels bioconda
conda config --add channels conda-forge
conda config --set channel_priority strict (可选)

查看已经添加的channels
conda config --get channels

## conda 常用操作

conda remove --name chipseq --all
conda clean --all

## 自定义新建环境所在的路径
nano ~/.condarc  # 或使用 vim/其他编辑器
envs_dirs:
  - /data/share/nas1/sjwlab/louhao/conda_envs
修改完之后 ctrl+x 退出
conda config --show envs_dirs  # 检查配置是否生效

如果上面的方法不生效，使用 -p参数
conda create -p /data/share/nas1/sjwlab/louhao/conda_envs/chipseq -c bioconda trim-galore bowtie2 samtools
使用完整路径激活
conda activate /data/share/nas1/sjwlab/louhao/conda_envs/chipseq

# info2

常规分析环境

conda create -n info squidpy
conda install aria2
pip install bypy

# velocyto

conda create -n velocyto2 python=3.10 "numpy<2" scipy cython numba matplotlib scikit-learn h5py click
conda activate velocyto2
pip install velocyto

velocyto --help

Error:ModuleNotFoundError: No module named 'numpy'
Solution：numpy<2

# sambamba
conda create -n sambamba sambamba
conda activate sambamba

# deepTools
conda create -n deepTools deepTools
# Htseq

conda create -n Htseq htseq
conda activate Htseq

htseq-count -h

# intervene
依赖比较复杂，注意单独创建环境
conda create -n intervene intervene
conda activate intervene
intervene --help

Error:
A module that was compiled using NumPy 1.x cannot be run in
NumPy 2.0.2 as it may crash. To support both 1.x and 2.x
versions of NumPy, modules must be compiled with NumPy 2.0.
Some module may need to rebuild instead e.g. with 'pybind11>=2.12'.

Solution: conda install numpy=2.0

# Homer
conda create -n Homer 
conda install homer

conda info -e
cd /data/share/nas1/sjwlab/louhao/conda_envs/Homer
ls
cd share
cd homer
perl configureHomer.pl -list # 查看配置文件
perl configureHomer.pl -install human
perl configureHomer.pl -install hg19

# sra-env

conda create -n sra-env -c bioconda parallel-fastq-dump 
conda activate sra-env
conda install sra-tools
注意使用conda list sra-tools，确保'sra-tools>=3.0.0'
parallel-fastq-dump  -h

# chipseq

conda create -n chipseq -c bioconda trim-galore bowtie2 
conda activate chipseq

cutadapt --version
fastqc --version
bowtie2 -h

samtools: error while loading shared libraries: libncurses.so.5: cannot open shared object file: No such file or directory
如果有软件用不了，就给他单独新建一个，比如samtools

# sam-tools
conda create -n sam-tools samtools
conda activate sam-tools
conda install bedtools

# macs
conda create -n macs 
pip install macs2

# bdg2bw

conda create -n bdg2bw ucsc-bedgraphtobigwig ucsc-bedclip bedtools
conda activate bdg2bw

# cell2location

conda create -n cell2location python=3.10.14
conda activate cell2location
pip install cell2location
pip install scvi-tools==1.2.2
pip install pooch

ImportError: cannot import name 'one_hot' from 'scvi.nn'
Solution:降低scvi-tools版本, pip install scvi-tools==1.2.2 pooch

# tangram

conda create -n tangram python=3.10.18
conda activate tangram
conda install scanpy squidpy
pip install tangram-sc

# stLearn

conda create -n stlearn python=3.10
conda activate stlearn
pip install -U stlearn

# scVelo
conda create -n scVelo python=3.10
conda install scvelo "numpy<2"
pip install jinja2
pip install python-igraph

如果 scv.tl.paga 报错，参考https://github.com/theislab/scvelo/issues/1241，修改源代码
这里安装的scvelo是0.3.3的版本，根据警告信息，里面有很多函数将在0.4弃用

# pyscenic

# r_env(Linux)

尽量使用conda进行R包的安装
Windows下不推荐使用conda管理R

conda create --name r_env 

conda activate r_env

conda install  r-base=4.4.2 r-essentials r-ggpubr #安装R和常用的数据分析R包

conda install r-biocmanager r-devtools r-remotes r-pak # 常用的用于下载R包的包

conda install bioconductor-edger bioconductor-deseq2 bioconductor-limma # 差异分析

conda install bioconductor-consensusclusterplus # 一致性聚类

conda intall r-wgcna # WGCNA 

conda install r-seurat bioconductor-glmgampoi presto rschauner::r-bpcells r-clustree r-harmony # 单细胞组学seurat相关包

conda install bioconductor-singler r-garnett # 单细胞自动注释软件

conda install dnachun::r-cellchat # 细胞通讯

conda install bioconductor-monocle r-monocle3 # 轨迹分析

conda install bioconda::bioconductor-ucell bioconductor-aucell # 评分

conda install bioconductor-clusterprofiler bioconductor-gseabase # 富集分析

conda install r-qs2 # 高效读写数据

conda install bioconductor-tcgabiolinks bioconductor-geoquery # 从 TCGA 和 GEO 获取数据

conda install r-signac # scATAC下游分析

conda install r-hdf5r

conda install bioconductor-ensdb.hsapiens.v86 bioconductor-bsgenome.hsapiens.ucsc.hg38 # 人 hg38

conda install bioconductor-ensdb.hsapiens.v75 bioconductor-bsgenome.hsapiens.ucsc.hg19 # 人hg19

conda install bioconductor-bsgenome.mmusculus.ucsc.mm10 bioconductor-ensdb.mmusculus.v79 # 鼠mm10

conda install bioconda::bioconductor-chipseeker # 用于 ChIP 峰注释、比较和可视化

conda install conda-forge::r-ggupset # upset图
